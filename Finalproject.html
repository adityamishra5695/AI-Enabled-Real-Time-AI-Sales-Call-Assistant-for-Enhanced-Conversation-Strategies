<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sales Assistant - Live Call Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .chat-bubble {
            max-width: 80%;
            position: relative;
        }
        .chat-bubble.customer {
            background-color: #e5e7eb;
            color: #1f2937;
            border-bottom-left-radius: 0;
        }
        .chat-bubble.manager {
            background-color: #2563eb;
            color: white;
            border-bottom-right-radius: 0;
        }
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Pulse animation for recording state */
        .recording-pulse {
            animation: pulse-red 1.5s infinite;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        /* Custom scrollbar for chat */
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        .chat-container::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .chat-container::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
    </style>
</head>
<body class="h-screen p-4 flex flex-col md:flex-row gap-6 overflow-hidden">

    <!-- LEFT PANEL: CONVERSATION HISTORY (Milestone 3) -->
    <div class="w-full md:w-5/12 flex flex-col glass-panel rounded-2xl h-full shadow-xl relative z-10">
        
        <!-- Header -->
        <div class="p-4 border-b border-gray-100 bg-white/50 rounded-t-2xl flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 animate-pulse">
                    <i class="fas fa-microphone"></i>
                </div>
                <div>
                    <h2 class="font-bold text-gray-800">Live Transcript</h2>
                    <p class="text-xs text-gray-500">Call ID: #4829 â€¢ Duration: 02:14</p>
                </div>
            </div>
            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded uppercase tracking-wide">Recording</span>
        </div>

        <!-- Chat Area -->
        <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4 chat-container bg-white/30">
            <!-- Initial Greeting -->
            <div class="flex justify-end">
                <div class="chat-bubble manager p-3 rounded-2xl shadow-sm">
                    <p class="text-sm">Hello! Thanks for calling TechSolutions. This is Alex speaking, how can I help you today?</p>
                </div>
            </div>
            <div class="flex justify-start">
                <div class="chat-bubble customer p-3 rounded-2xl shadow-sm">
                    <p class="text-sm">Hi Alex, I'm looking for a new laptop for my design work.</p>
                </div>
            </div>
        </div>

        <!-- Simulator Inputs -->
        <div class="p-4 bg-gray-50 rounded-b-2xl border-t border-gray-200">
            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Simulate Customer Input</label>
            <div class="flex gap-2 mb-3">
                <button onclick="simulateCustomer('price')" class="flex-1 text-xs bg-white border border-gray-200 hover:bg-gray-100 py-2 rounded-lg transition">"Too Expensive"</button>
                <button onclick="simulateCustomer('warranty')" class="flex-1 text-xs bg-white border border-gray-200 hover:bg-gray-100 py-2 rounded-lg transition">"Is it durable?"</button>
                <button onclick="simulateCustomer('competitor')" class="flex-1 text-xs bg-white border border-gray-200 hover:bg-gray-100 py-2 rounded-lg transition">"Why Dell?"</button>
            </div>
            
            <div class="flex gap-2 items-center">
                 <!-- Real Mic Button -->
                <button id="realMicBtn" onclick="toggleListening()" class="flex-none w-11 h-11 rounded-xl bg-gray-100 text-gray-600 hover:bg-red-50 hover:text-red-600 flex items-center justify-center transition-all border border-gray-200" title="Click to Speak">
                    <i class="fas fa-microphone"></i>
                </button>

                <!-- Text Input -->
                <div class="relative flex-1">
                    <input type="text" id="customInput" placeholder="Type or use mic..." 
                        class="w-full pl-4 pr-12 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none shadow-sm text-sm"
                        onkeypress="handleEnter(event)">
                    <button onclick="sendCustomInput()" class="absolute right-2 top-2 w-8 h-8 bg-blue-600 rounded-lg text-white hover:bg-blue-700 flex items-center justify-center">
                        <i class="fas fa-paper-plane text-xs"></i>
                    </button>
                </div>
            </div>
             <p id="micStatus" class="text-[10px] text-gray-400 mt-2 h-4">Click mic to start speaking...</p>
        </div>
    </div>

    <!-- RIGHT PANEL: AI REASONING (Milestone 4) -->
    <div class="w-full md:w-7/12 flex flex-col h-full relative">
        
        <!-- Background Blobs -->
        <div class="absolute top-10 right-10 w-64 h-64 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
        <div class="absolute bottom-10 left-10 w-64 h-64 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>

        <div class="glass-panel flex-1 rounded-2xl p-6 relative z-10 flex flex-col overflow-hidden shadow-xl">
            
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-brain text-purple-600"></i> AI Copilot
                    </h2>
                    <p class="text-sm text-gray-500">Real-time reasoning & suggestions</p>
                </div>
                <!-- Status Indicators -->
                <div class="flex gap-4">
                    <div class="text-center">
                        <p class="text-[10px] uppercase font-bold text-gray-400">Sentiment</p>
                        <span id="sentimentBadge" class="inline-block px-2 py-0.5 rounded text-xs font-bold bg-gray-200 text-gray-600">Neutral</span>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] uppercase font-bold text-gray-400">Intent</p>
                        <span id="intentBadge" class="inline-block px-2 py-0.5 rounded text-xs font-bold bg-blue-100 text-blue-600">Inquiry</span>
                    </div>
                </div>
            </div>

            <!-- AI Cards Grid -->
            <div class="grid grid-cols-1 gap-4 overflow-y-auto pb-4">
                
                <!-- 1. Suggested Question -->
                <div class="bg-white border-l-4 border-blue-500 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow group">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xs font-bold text-blue-500 uppercase tracking-widest">Next Best Question</h3>
                        <button onclick="useSuggestion('question')" class="opacity-0 group-hover:opacity-100 transition-opacity bg-blue-50 text-blue-600 text-xs px-2 py-1 rounded hover:bg-blue-100 border border-blue-200">
                            Use this <i class="fas fa-arrow-left ml-1"></i>
                        </button>
                    </div>
                    <p id="aiQuestion" class="text-lg font-medium text-gray-800 leading-relaxed">How demanding are the design applications you use daily?</p>
                </div>

                <!-- 2. Objection Handling -->
                <div class="bg-white border-l-4 border-amber-500 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow group">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xs font-bold text-amber-500 uppercase tracking-widest">Objection Handler</h3>
                        <button onclick="useSuggestion('objection')" class="opacity-0 group-hover:opacity-100 transition-opacity bg-amber-50 text-amber-600 text-xs px-2 py-1 rounded hover:bg-amber-100 border border-amber-200">
                            Use this <i class="fas fa-arrow-left ml-1"></i>
                        </button>
                    </div>
                    <p id="aiObjection" class="text-gray-600 italic">I understand the budget is tight. However, investing in the right specs now saves upgrade costs later.</p>
                </div>

                <!-- 3. Product & Insight Row -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- Product -->
                    <div class="bg-gray-800 text-white rounded-lg p-4 shadow-lg relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-white/5 rounded-full -mr-8 -mt-8"></div>
                        <h3 class="text-[10px] text-gray-400 uppercase tracking-widest mb-1">Recommended Product</h3>
                        <p id="aiProduct" class="text-xl font-bold text-white mb-2">MacBook Pro 14"</p>
                        <button onclick="useSuggestion('product')" class="w-full text-center py-1.5 rounded bg-white/10 hover:bg-white/20 text-xs transition text-gray-300">
                            Pitch This Product
                        </button>
                    </div>

                    <!-- Insight -->
                    <div class="bg-purple-50 border border-purple-100 rounded-lg p-4 flex flex-col justify-center">
                        <h3 class="text-[10px] text-purple-400 uppercase tracking-widest mb-1">Live Insight</h3>
                        <div class="flex items-start gap-2">
                            <i class="fas fa-lightbulb text-purple-500 mt-1"></i>
                            <p id="aiInsight" class="text-sm text-purple-800 font-medium">Customer focused on performance.</p>
                        </div>
                    </div>
                </div>

            </div>
            
            <!-- Context Data Footer -->
            <div class="mt-auto pt-4 border-t border-gray-100">
                <p class="text-[10px] text-gray-400 font-mono">
                    ENTITIES EXTRACTED: <span id="entityLog" class="text-gray-600">{ "Role": "Designer" }</span>
                </p>
            </div>

        </div>
    </div>

    <script>
        // --- LOGIC: MOCK AI BRAIN ---
        function getAIResponse(text, intentOverride) {
            text = text.toLowerCase();
            
            if (text.includes('expensive') || text.includes('price') || text.includes('cost') || intentOverride === 'price') {
                return {
                    sentiment: "Negative",
                    intent: "Price Objection",
                    question: "Would you be open to a financing plan to split the cost over 12 months?",
                    objection: "I completely hear you on the price. Let's look at the long-term value vs. replacing a cheaper unit in 2 years.",
                    product: "Dell XPS 13 (Refurbished)",
                    insight: "High price sensitivity detected. Pivot to value or payment terms.",
                    entities: { "Constraint": "Budget", "Risk": "High" }
                };
            }
            else if (text.includes('warranty') || text.includes('break') || text.includes('durable') || intentOverride === 'warranty') {
                return {
                    sentiment: "Anxious",
                    intent: "Trust Inquiry",
                    question: "Have you had issues with hardware reliability in the past?",
                    objection: "We offer a 'No-Questions-Asked' replacement policy for the first 30 days, plus a 2-year warranty.",
                    product: "Lenovo ThinkPad X1 (Military Grade)",
                    insight: "Customer needs reassurance. Focus on support and build quality.",
                    entities: { "Feature": "Durability", "Pain_Point": "Reliability" }
                };
            }
            else if (text.includes('why') || text.includes('better') || text.includes('compare') || intentOverride === 'competitor') {
                return {
                    sentiment: "Skeptical",
                    intent: "Competitor Analysis",
                    question: "What specific features are you comparing with the other brand?",
                    objection: "While they are cheaper, our screen color accuracy is 40% higher, which is crucial for your design work.",
                    product: "ProArt StudioBook",
                    insight: "Comparison shopping. Highlight unique differentiators.",
                    entities: { "Competitor": "Unknown", "Focus": "Specs" }
                };
            }
            else {
                return {
                    sentiment: "Neutral",
                    intent: "General Discovery",
                    question: "What software suite do you spend most of your day in?",
                    objection: "That's a great point. Let's make sure we find something that handles that workload effortlessly.",
                    product: "MacBook Pro M3",
                    insight: "Discovery phase. Ask open-ended questions to build profile.",
                    entities: { "Role": "Designer", "Stage": "Early" }
                };
            }
        }

        // --- UI CONTROLLER ---
        
        const chatContainer = document.getElementById('chatContainer');

        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `flex justify-${role === 'customer' ? 'start' : 'end'} fade-in-up`;
            
            div.innerHTML = `
                <div class="chat-bubble ${role} p-3 rounded-2xl shadow-sm">
                    <p class="text-sm">${text}</p>
                    <span class="text-[10px] opacity-70 block text-right mt-1">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
            `;
            
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function updateAIDashboard(data) {
            // Update Badges
            const sentBadge = document.getElementById('sentimentBadge');
            sentBadge.innerText = data.sentiment;
            sentBadge.className = `inline-block px-2 py-0.5 rounded text-xs font-bold ${getSentimentColor(data.sentiment)}`;
            
            document.getElementById('intentBadge').innerText = data.intent;

            // Update Text Content with simple animation
            updateTextWithFade('aiQuestion', data.question);
            updateTextWithFade('aiObjection', data.objection);
            updateTextWithFade('aiProduct', data.product);
            updateTextWithFade('aiInsight', data.insight);
            
            // Update Footer
            document.getElementById('entityLog').innerText = JSON.stringify(data.entities);
        }

        function updateTextWithFade(id, text) {
            const el = document.getElementById(id);
            el.style.opacity = '0';
            setTimeout(() => {
                el.innerText = text;
                el.style.opacity = '1';
            }, 200);
        }

        function getSentimentColor(sent) {
            if (sent === 'Negative' || sent === 'Anxious') return 'bg-red-100 text-red-600';
            if (sent === 'Positive') return 'bg-green-100 text-green-600';
            return 'bg-gray-200 text-gray-600';
        }

        // --- SIMULATION HANDLERS ---

        function simulateCustomer(type) {
            let text = "";
            if (type === 'price') text = "That sounds good, but $2000 is way over my budget right now.";
            if (type === 'warranty') text = "I'm clumsy. What happens if I drop it? Is it durable?";
            if (type === 'competitor') text = "Why should I buy this Dell when the HP Omen is $300 cheaper?";
            
            handleCustomerInput(text, type);
        }

        function sendCustomInput() {
            const input = document.getElementById('customInput');
            const text = input.value;
            if (!text) return;
            
            handleCustomerInput(text, null);
            input.value = "";
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendCustomInput();
        }

        function handleCustomerInput(text, intentOverride) {
            // 1. Add to Chat
            addMessage('customer', text);
            
            // 2. Get Brain Logic
            const aiData = getAIResponse(text, intentOverride);
            
            // 3. Update Dashboard
            updateAIDashboard(aiData);
        }

        // --- AGENT INTERACTION ---

        function useSuggestion(type) {
            let text = "";
            if (type === 'question') text = document.getElementById('aiQuestion').innerText;
            if (type === 'objection') text = document.getElementById('aiObjection').innerText;
            if (type === 'product') text = "I highly recommend the " + document.getElementById('aiProduct').innerText + " for your specific needs.";
            
            addMessage('manager', text);
        }

        // --- SPEECH RECOGNITION SETUP ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        const micBtn = document.getElementById('realMicBtn');
        const micStatus = document.getElementById('micStatus');
        let isListening = false;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false; // Stop after one sentence
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            recognition.onstart = function() {
                isListening = true;
                micBtn.classList.remove('bg-gray-100', 'text-gray-600');
                micBtn.classList.add('bg-red-100', 'text-red-600', 'recording-pulse');
                micStatus.innerText = "Listening... Speak now";
                micStatus.classList.add('text-red-500');
            };

            recognition.onend = function() {
                isListening = false;
                micBtn.classList.add('bg-gray-100', 'text-gray-600');
                micBtn.classList.remove('bg-red-100', 'text-red-600', 'recording-pulse');
                micStatus.innerText = "Click mic to start speaking...";
                micStatus.classList.remove('text-red-500');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                // Optional: Show in input first
                document.getElementById('customInput').value = transcript;
                // Automatically handle input
                handleCustomerInput(transcript, null);
            };
            
            recognition.onerror = function(event) {
                console.error("Speech recognition error", event.error);
                micStatus.innerText = "Error: " + event.error;
            };

        } else {
            console.log("Web Speech API not supported");
            micBtn.style.display = 'none'; // Hide if not supported
            micStatus.innerText = "Speech-to-text not supported in this browser.";
        }

        function toggleListening() {
            if (!recognition) {
                alert("Speech to text is not supported in this browser. Please use Chrome or Edge.");
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

    </script>
</body>
</html>
